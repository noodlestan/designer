---
title: Loading and Validating Decisions
slug: guides/validating-design-decisions-with-schemas
description: How to validate design decisions with JSON schemas and validators
sidebar:
    order: 20
    label: Validating Decisions
---

import { CardGrid, FileTree, LinkCard } from '@astrojs/starlight/components';

## Setup

This guide assumes... ğŸš§

### Dependencies

The following packages are required:

-   [@noodlestan/designer-functions](/api/designer-functions)
-   [@noodlestan/designer-schemas](/api/designer-schemas)

```bash
npm install @noodlestan/designer-functions @noodlestan/designer-schemas
```

### Decision data

Populate your design decisions data source.

As illustrated in the [Capturing Design Decisions](/guides/capturing-design-decisions-in-data)
guide, you can simply create one or more JSON files anywhere in your project.

<FileTree>

-   data/
    -   decisions/
        -   color.json
        -   space.json
        -   ...

</FileTree>

## Script

Add a script to load decisions and print eventual validation errors.

<FileTree>
-   data/
-   scripts
    - **validate-decisions.js**

</FileTree>

We will use the _all-in-one_
[createDecisionLoader()](/api/designer-functions/Loader/createDecisionLoader)
providing it with:

-   A list of directories to look for JSON files.
-   A list of SchemaConfig to load validation schemas from.
-   A function to resolve the physical location of node modules containing the schemas.

```js
// src/scripts/validate-decisions.js
import path from 'path';

import { createDecisionLoader, formatValidationError } from '@noodlestan/designer-functions';
import { DECISION_SCHEMAS } from '@noodlestan/designer-schemas';

const DATA_PATH = path.resolve('./data/decisions');

const loader = createDecisionLoader(
    [DATA_PATH],
    [DECISION_SCHEMAS],
    async (moduleName: string) => `../../../node_modules/${moduleName}`,
);
```

The loader returns a
[populated decision store](/api/designer-functions/Types/StaticDecisionStore)
asynchronously.

We can use this store to inspect loaded decision records and errors.

```js
// src/scripts/validate-decisions.js
const loadDecisions = async () => {
    const store = await loader();
    if (store.hasErrors()) {
        store.allErrors().forEach(error => console.error(formatValidationError(error)));
    } else {
        store.records().forEach(record => console.info(record));
    }
    console.info(`ğŸ˜ ${store.records().length} decisions, ${store.allErrors().length} errors`);
};

loadDecisions();
```

You can run this directly from the command line:

```bash
node scripts/build-decisions.js
```

The output should look something like:

```
...
{
  model: 'color-set/modifier',
  name: 'Green Foregrounds',
  description: 'Green shades for foregrounds',
  usage: { intendedFor: [ 'Typography', 'Foregrounds' ], notFor: [ 'Icons' ] },
  params: {
    start: { '$name': 'Green Foreground', '$type': 'color-value' },
    modifier: { hue: 0, lightness: 5, saturation: -5 },
    steps: 5
  }
}
ğŸ˜ 4 decisions, 0 errors
```

In case of validation errors these will be printed using the `formatValidationError()` formatter.

For instance, if we delete the `param` attribute from a couple of decision input records:

```
ğŸŸ¨ Decision Curcuma Foreground (required) must have required property 'params'
ğŸŸ¨ Decision Green Foreground (required) must have required property 'params'
ğŸ˜ 4 decisions, 2 errors
```

## Next steps

The next guides provide step by step instructions on practical uses cases for your decision data:

<CardGrid>
    <LinkCard
        href="/guides/generating-css-variables-from-design-decisions-and-tokens"
        title="Generating CSS Variables"
    />
    <LinkCard
        href="/guides/documenting-design-decisions-with-astro-and-mdx"
        title="Rendering in Astro MDX"
    />

</CardGrid>

## See Also

-   [Decision Models Reference](/decision-models)
-   [Schemas Reference](/schemas)
